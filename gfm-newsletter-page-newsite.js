document.addEventListener("DOMContentLoaded",(()=>{let e=[...document.querySelectorAll(".multistep-form-step-newsletter")],t=document.querySelector(".multistep-form-progressbar-progress-newsletter"),r=document.querySelector(".get-the-framework-modal-newsletter"),o=document.querySelectorAll("#blurred-bg-close-gfm-1, #close-gfm-1"),a=0,n={},d="https://founderos.app.n8n.cloud/webhook/newsletter-partial";const l=()=>{t.style.width=(a+1)/e.length*100+"%"},s=()=>{document.querySelectorAll(".gfm-form-newsletter input, .gfm-form-newsletter select, .gfm-form-newsletter textarea").forEach((e=>{const t=e.name||e.id;t&&("checkbox"===e.type?n[t]=e.checked:"radio"===e.type?e.checked&&(n[t]=e.value):n[t]=e.value.trim())}))},c=t=>{const r=e[a];([...r.querySelectorAll("input[required]")].every((e=>{const t=r.querySelector(`[data-error-for="${e.id}"]`);let o=!!e.value.trim(),a="";return"email"===e.type&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||(o=!1,a="Please enter a valid email address.")),!o&&t?(t.textContent=a||"This field is required.",t.classList.remove("hide")):t&&t.classList.add("hide"),o}))||1!==t)&&(e[a].style.display="none",a+=t,e[a].style.display="block",l(),window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(a)||(fathom.trackEvent("Get Framework Modal (Step: $ {\n            a+1\n        }\n        )"),window.trackedSteps.add(a))),(async()=>{s();try{await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:n,step:a,timestamp:(new Date).toISOString()})})}catch(e){console.error("Partial data send failed:",e)}})())};e.forEach(((e,t)=>{e.style.display=0===t?"block":"none",e.querySelector(".msf-button")?.addEventListener("click",(e=>{e.preventDefault(),c(1)})),e.querySelector(".msf-back-button")?.addEventListener("click",(e=>{e.preventDefault(),a>0&&c(-1)}))})),l(),o.forEach((e=>{e.addEventListener("click",(()=>{r&&(r.style.display="none",document.body.style.overflow="")}))})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&r?(r.style.display="none",document.body.style.overflow=""):"Enter"===t.key&&(t.preventDefault(),a<e.length-1&&c(1))})),document.querySelectorAll(".gfm-cta-newsletter").forEach((e=>{e.addEventListener("click",(()=>{const t=document.querySelector(".gfm-form-newsletter");t&&(t.dataset.fathom=e.dataset.fathom,t.id=e.id),r&&(r.style.display="block",window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(0)||(fathom.trackEvent("Get Framework Modal (Step: 1)"),window.trackedSteps.add(0))))}))})),document.querySelectorAll(".gfm-form-newsletter").forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault(),s(),fathom.trackEvent("Get Framework Modal Form Submit")}))})),window.addEventListener("beforeunload",(async()=>{s();try{await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:n,step:a,timestamp:(new Date).toISOString()}),keepalive:!0})}catch(e){console.error("Failed to send data before unload:",e)}}))}));