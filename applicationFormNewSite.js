let currentStep=0,currentFormData={};$(document).ready((function(){function t(){const t=currentStep/(l-1)*100;i.css("width",t+"%"),$(".multistep-progress-number").text(currentStep+1+"/"+l),$(".multistep-progress-percent").text(Math.round(t)+"%")}function e(){c.hide().eq(currentStep).show(),$(".multistep-form-previous-modal").toggle(currentStep>0),$(".multistep-form-next-modal").toggle(currentStep<l-1)}function o(){$(".multistep-form-modal input, .multistep-form-modal select, .multistep-form-modal textarea").each((function(){const t=$(this).attr("name")||$(this).attr("id");t&&($(this).is(":checkbox")?currentFormData[t]=$(this).prop("checked"):$(this).is(":radio")?$(this).prop("checked")&&(currentFormData[t]=$(this).val()):currentFormData[t]=$(this).val().trim())}))}const n="https://founderos.app.n8n.cloud/webhook/webhook/partial-lead";async function r(){o();try{if(!(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:currentFormData,step:currentStep,timestamp:(new Date).toISOString()})})).ok)throw new Error("Failed to send partial data")}catch(t){console.error("Partial data send failed:",t)}}async function a(o){if(currentStep+o>=0&&currentStep+o<l){let n=c.eq(currentStep);if(1!==o||function(t){let e=t.find("#Email"),o=t.find("#Phone-Number"),n=t.find(".multistep-form-error"),r=!0;var a;return e.length&&(a=e.val().trim(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)||(n.text("Please enter a valid email address.").show(),r=!1)),o.length&&/[a-zA-Z]/.test(o.val().trim())&&(n.text("Phone number should not contain letters.").show(),r=!1),r&&n.hide(),r}(n)){if(currentStep+=o,window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,!window.trackedSteps.has(currentStep))){const t=`Application Form Submit (Step: ${currentStep+1})`;fathom.trackEvent(t),window.trackedSteps.add(currentStep)}e(),t(),await r()}}}const c=$(".multistep-form-step-modal "),i=$(".multistep-form-progressbar-progress-modal"),l=c.length;$(".msf-button, .multistep-form-next-modal ").click((()=>a(1))),$(".multistep-form-previous-modal ").click((()=>a(-1))),$(".multistep-choice").change((function(){$("#first-question-no").is(":checked")?window.location.href="/revenue-accelerator":a(1)})),$("#first-question-no").on("click",(function(){window.location.href="/revenue-accelerator"})),e(),t(),$(".multistep-form-modal").submit((function(t){fathom.trackEvent("Application Form Submit - Variant A"),t.preventDefault(),o();let e=(currentFormData["Full-Name"]||"").trim(),[n,...r]=e.split(" "),a=r.join(" "),c=encodeURIComponent(n),i=encodeURIComponent(a),l=encodeURIComponent(currentFormData.Email||""),s=encodeURIComponent(currentFormData.phone||"");const d=Math.floor(100*Math.random())<100,m=d?"/schedule/call":"/schedule/call";fathom.trackEvent(d?"Redirect to Setter (Intro Call)":"Redirect to Closer (Call)"),localStorage.setItem("bookingOutcome",d?"setter":"closer"),window.location.href=`${m}?firstname=${c}&lastname=${i}&phone=${s}&email=${l}`})),document.querySelectorAll(".multistep-choice-checkbox input").forEach((t=>{t.addEventListener("change",(()=>{const e=t.closest(".multistep-choice-checkbox");t.checked?e.style.backgroundColor="#ffffff4d":e.style.backgroundColor=""}))})),document.querySelectorAll(".multistep-choice-last input").forEach((t=>{t.addEventListener("change",(()=>{!function(t,e){document.querySelectorAll(e).forEach((t=>{t.style.backgroundColor=""}));const o=t.closest(e);t.checked&&(o.style.backgroundColor="#ffffff4d")}(t,".multistep-choice-last"),r()}))})),$(document).on("keydown",(function(t){"Enter"===t.key&&(t.preventDefault(),$(".multistep-form-next-modal ").click()),"Escape"===t.key&&(document.querySelector(".appplication-form-modal").style.display="none",document.body.style.overflow="")})),document.addEventListener("click",(function(t){t.target.closest(".application-open")&&(document.querySelectorAll(".appplication-form-modal").forEach((t=>t.style.display="flex")),document.body.style.overflow="hidden",window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(0)||(fathom.trackEvent("Application Form Submit (Step: 1)"),window.trackedSteps.add(0)))),t.target.closest(".application-close")&&(document.querySelectorAll(".appplication-form-modal").forEach((t=>t.style.display="none")),document.body.style.overflow="")})),window.addEventListener("beforeunload",(async function(t){o();try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:currentFormData,step:currentStep,timestamp:(new Date).toISOString()}),keepalive:!0})}catch(t){console.error("Failed to send data before unload:",t)}})),console.error=function(){}}));