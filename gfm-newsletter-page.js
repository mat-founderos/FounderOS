document.addEventListener("DOMContentLoaded",(()=>{let e=[...document.querySelectorAll(".multistep-form-step-newsletter")],t=document.querySelector(".multistep-form-progressbar-progress-newsletter"),r=document.querySelector(".get-the-framework-modal-newsletter"),o=document.querySelectorAll("#blurred-bg-close-gfm-1, #close-gfm-1"),a=0,l={},n="https://founderos.app.n8n.cloud/webhook/newsletter-partial";const s=()=>{t.style.width=(a+1)/e.length*100+"%"},d=()=>{document.querySelectorAll(".gfm-form-newsletter input, .gfm-form-newsletter select, .gfm-form-newsletter textarea").forEach((e=>{const t=e.name||e.id;t&&("checkbox"===e.type?l[t]=e.checked:"radio"===e.type?e.checked&&(l[t]=e.value):l[t]=e.value.trim())}))},c=t=>{const r=e[a];([...r.querySelectorAll("input[required]")].every((e=>{const t=r.querySelector(`[data-error-for="${e.id}"]`);let o=!!e.value.trim(),a="";if("email"===e.type){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.value.trim())||(o=!1,a="Please enter a valid email address.")}return!o&&t?(t.textContent=a||"This field is required.",t.classList.remove("hide")):t&&t.classList.add("hide"),o}))||1!==t)&&(e[a].style.display="none",a+=t,e[a].style.display="block",s(),window.fathom&&(window.trackedSteps=window.trackedSteps||new Set,window.trackedSteps.has(a)||(fathom.trackEvent(`Get Framework Modal (Step: ${a+1})`),window.trackedSteps.add(a))),(async()=>{d();try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:l,step:a,timestamp:(new Date).toISOString()})})}catch(e){console.error("Partial data send failed:",e)}})())};window.fathom&&fathom.trackEvent("Get Framework Modal (Step: 1)"),e.forEach(((e,t)=>{e.style.display=0===t?"block":"none",e.querySelector(".msf-button")?.addEventListener("click",(e=>{e.preventDefault(),c(1)})),e.querySelector(".msf-back-button")?.addEventListener("click",(e=>{e.preventDefault(),a>0&&c(-1)}))})),s(),o.forEach((e=>{e.addEventListener("click",(()=>{r&&(r.style.display="none",document.body.style.overflow="")}))})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&r?(r.style.display="none",document.body.style.overflow=""):"Enter"===t.key&&(t.preventDefault(),a<e.length-1&&c(1))})),document.querySelectorAll(".gfm-cta-newsletter").forEach((e=>{e.addEventListener("click",(()=>{const t=document.querySelector(".gfm-form-newsletter");t&&(t.dataset.fathom=e.dataset.fathom,t.id=e.id),r&&(r.style.display="block"),console.log("Fathom value:",e.dataset.fathom)}))})),document.querySelectorAll(".gfm-form-newsletter").forEach((e=>{let t=e.querySelector("#First-Name"),r=e.querySelector("#Email"),o=e.querySelector("#phone");e.addEventListener("submit",(e=>{e.preventDefault(),d(),fathom.trackEvent("Get Framework Modal Form Submit");let a=new URLSearchParams({email:r?.value||"",firstname:t?.value||"",phone:o?.value||""}).toString();window.location.href=`/thank-you-newsletter?${a}`}))})),window.addEventListener("beforeunload",(async()=>{d();try{await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"partial",formData:l,step:a,timestamp:(new Date).toISOString()}),keepalive:!0})}catch(e){console.error("Failed to send data before unload:",e)}}))}));